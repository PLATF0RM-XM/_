<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>منصة متابعة الصفقات</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{
 margin:0;
 font-family:system-ui;
 background:#0f1f3e;
 color:#eaf0ff;
}
header{
 background:linear-gradient(135deg,#0b1833,#132a5a);
 padding:18px;
 text-align:center;
}
.card{
 background:#1c2d52;
 border-radius:18px;
 padding:22px;
 margin:20px;
 box-shadow:0 10px 30px rgba(0,0,0,.35);
}
input,button{
 width:100%;
 padding:14px;
 border:none;
 border-radius:12px;
 font-size:16px;
 margin-top:10px;
}
button{
 background:#00b05c;
 color:#fff;
 font-weight:bold;
}
.status{
 margin-top:10px;
 padding:10px;
 border-radius:10px;
 text-align:center;
}
footer{
 text-align:center;
 font-size:12px;
 color:#9fb0d1;
 padding:20px;
}
</style>
</head>

<body>

<header>
 <h2>متابعة الصفقة</h2>
</header>

<div class="card">
 <input id="deal" placeholder="رقم الصفقة">
 <button onclick="load()">متابعة</button>
</div>

<div class="card" id="d" style="display:none">
 <p>الاسم: <b id="n"></b></p>
 <p>مبلغ الاستثمار: <b id="i"></b></p>
 <p>الأرباح: <b id="p"></b></p>
 <p>الرسوم: <b id="f"></b></p>
 <p>حالة الرسوم: <b id="fs"></b></p>
 <p>وقت السداد: <b id="ft"></b></p>
 <button id="payBtn" onclick="pay()" style="display:none">سدد الآن</button>
</div>

<footer>
 هذه الصفحة مخصصة لمتابعة حالة الصفقات فقط
</footer>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDCVCtl1ca3NSoy6tAWCp-ykgGBa21ZNp8",
 authDomain:"investment-platform-b419d.firebaseapp.com",
 projectId:"investment-platform-b419d",
 storageBucket:"investment-platform-b419d.firebasestorage.app"
});

const db=firebase.firestore();
const storage=firebase.storage();
let current="";

function load(){
 current=deal.value;
 db.collection("deals").doc(current).onSnapshot(doc=>{
  if(!doc.exists){alert("رقم الصفقة غير موجود");return;}
  const x=doc.data();
  d.style.display="block";
  n.innerText=x.name;
  i.innerText=x.investment;
  p.innerText=x.profit;
  f.innerText=x.fee;
  fs.innerText=x.feeStatus;
  ft.innerText=x.feeTime||"-";
  payBtn.style.display=x.feeStatus==="في انتظار سداد الرسوم"?"block":"none";
 });
}

function pay(){
 const i=document.createElement("input");
 i.type="file";
 i.accept="image/*";
 i.onchange=async()=>{
  const f=i.files[0];
  if(!f)return;
  await storage.ref("proofs/"+current+".jpg").put(f);
  alert("تم رفع إثبات السداد");
 };
 i.click();
}
</script>

</body>
</html>
