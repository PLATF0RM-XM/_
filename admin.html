<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#0f1f3e;color:#eaf0ff}
header{background:linear-gradient(135deg,#0b1833,#132a5a);padding:16px;text-align:center}
.card{background:#1c2d52;border-radius:16px;padding:22px;margin:20px}
input,button,select{width:100%;padding:14px;border-radius:10px;border:none;margin-top:10px}
button{background:#00b05c;color:#fff;font-weight:bold}
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{padding:8px;border-bottom:1px solid #2c3f6f;text-align:center}
</style>
</head>

<body>

<header>
 <div style="font-size:20px;font-weight:700;color:#00b05c">لوحة تحكم الإدارة</div>
</header>

<div class="card" id="login">
 <input id="email" placeholder="البريد الإلكتروني">
 <input id="password" type="password" placeholder="كلمة المرور">
 <button onclick="login()">تسجيل الدخول</button>
</div>

<div class="card" id="panel" style="display:none">
 <table>
  <thead>
   <tr><th>رقم الصفقة</th><th>الاسم</th><th>إثبات التحويل</th><th>الحالة</th></tr>
  </thead>
  <tbody id="rows"></tbody>
 </table>
</div>

<script>
const firebaseConfig={
 apiKey:"AIzaSyDCVCtl1ca3NSoy6tAWCp-ykgGBa21ZNp8",
 authDomain:"investment-platform-b419d.firebaseapp.com",
 projectId:"investment-platform-b419d",
 storageBucket:"investment-platform-b419d.firebasestorage.app",
 messagingSenderId:"831226258536",
 appId:"1:831226258536:web:6aae445cb9d33d06cd07dd",
 measurementId:"G-BVHHWWF7DL"
};

firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .catch(()=>alert("بيانات غير صحيحة"));
}

auth.onAuthStateChanged(u=>{
 if(u){
  login.style.display="none";
  panel.style.display="block";
  loadDeals();
 }
});

function loadDeals(){
 db.collection("deals").onSnapshot(s=>{
  let h="";
  s.forEach(doc=>{
   const d=doc.data();
   h+=`<tr>
<td>${doc.id}</td>
<td>${d.name}</td>
<td>
 <button onclick="viewProof('${doc.id}')">عرض الصورة</button>
</td>
<td>
 <select onchange="db.collection('deals').doc('${doc.id}').update({status:this.value})">
  <option ${d.status==="Pending"?"selected":""}>قيد المراجعة</option>
  <option ${d.status==="Paid"?"selected":""}>تم السداد</option>
  <option ${d.status==="Rejected"?"selected":""}>مرفوض</option>
 </select>
</td>
</tr>`;
  });
  rows.innerHTML=h;
 });
}
</script>

<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:9999;align-items:center;justify-content:center">
 <div style="background:#1c2d52;padding:15px;border-radius:12px;max-width:90%">
  <img id="proofImg" style="max-width:100%;border-radius:10px">
  <button onclick="closeModal()" style="margin-top:10px">إغلاق</button>
 </div>
</div>

<script>
const storage=firebase.storage();
function viewProof(id){
 storage.ref("proofs/"+id+".jpg").getDownloadURL()
 .then(url=>{
  document.getElementById("proofImg").src=url;
  document.getElementById("modal").style.display="flex";
 })
 .catch(()=>alert("لا يوجد إثبات تحويل"));
}
function closeModal(){
 document.getElementById("modal").style.display="none";
}
</script>

</body>
</html>
