<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة تحكم الإدارة</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
 margin:0;
 font-family:Arial, sans-serif;
 background:linear-gradient(135deg,#081c3a,#0b2c5d);
 color:#fff;
}
.container{
 max-width:900px;
 margin:40px auto;
 background:rgba(255,255,255,0.12);
 backdrop-filter:blur(14px);
 padding:25px;
 border-radius:18px;
 box-shadow:0 20px 40px rgba(0,0,0,.35);
}
input,select,button{
 width:100%;
 padding:14px;
 margin:8px 0;
 border:none;
 border-radius:12px;
 font-size:15px;
}
input,select{background:#fff;color:#000}
button{background:#00b05c;color:#fff;font-weight:bold}
button.edit{background:#2980b9}
.hidden{display:none}
table{
 width:100%;
 border-collapse:collapse;
 margin-top:20px;
}
th,td{
 padding:10px;
 border-bottom:1px solid rgba(255,255,255,.2);
 text-align:center;
}
</style>
</head>

<body>

<div class="container" id="loginBox">
 <h2>تسجيل دخول الإدارة</h2>
 <input id="email" placeholder="البريد الإلكتروني">
 <input id="password" type="password" placeholder="كلمة المرور">
 <button onclick="login()">دخول</button>
</div>

<div class="container hidden" id="adminPanel">
 <h2>لوحة الأدمن</h2>

 <h3 id="formTitle">إضافة صفقة</h3>
 <input id="dealId" placeholder="رقم الصفقة">
 <input id="investorName" placeholder="اسم المستثمر">
 <input id="investmentAmount" placeholder="مبلغ الاستثمار">
 <input id="profitNumber" placeholder="رقم استلام الأرباح">

 <select id="hasFees" onchange="toggleFees()">
  <option value="no">لا توجد رسوم</option>
  <option value="yes">توجد رسوم لاستلام الأرباح</option>
 </select>

 <input id="feeAmount" class="hidden" placeholder="مبلغ الرسوم المطلوبة">

 <button onclick="saveDeal()" id="saveBtn">إضافة الصفقة</button>

 <h3>الصفقات</h3>
 <table>
  <thead>
   <tr>
    <th>رقم الصفقة</th>
    <th>الاسم</th>
    <th>الاستثمار</th>
    <th>الرسوم</th>
    <th>الحالة</th>
    <th>تحكم</th>
   </tr>
  </thead>
  <tbody id="rows"></tbody>
 </table>
</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDCVCtl1ca3NSoy6tAWCp-ykgGBa21ZNp8",
 authDomain:"investment-platform-b419d.firebaseapp.com",
 projectId:"investment-platform-b419d"
});

const auth=firebase.auth();
const db=firebase.firestore();
let editMode=false;

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .then(()=>{
  loginBox.classList.add("hidden");
  adminPanel.classList.remove("hidden");
  loadDeals();
 })
 .catch(e=>alert(e.message));
}

function toggleFees(){
 if(hasFees.value==="yes"){
  feeAmount.classList.remove("hidden");
 }else{
  feeAmount.classList.add("hidden");
 }
}

function saveDeal(){
 const data={
  investorName: investorName.value,
  investmentAmount: investmentAmount.value,
  profitNumber: profitNumber.value,
  feesRequired: hasFees.value==="yes",
  feeAmount: hasFees.value==="yes"?feeAmount.value:"",
  feeStatus: hasFees.value==="yes"?"في انتظار سداد الرسوم":"لا توجد رسوم"
 };

 if(editMode){
  db.collection("deals").doc(dealId.value).update(data);
  alert("تم تعديل الصفقة");
 }else{
  db.collection("deals").doc(dealId.value).set(data);
  alert("تمت إضافة الصفقة");
 }

 resetForm();
}

function editDeal(id,data){
 editMode=true;
 formTitle.innerText="تعديل الصفقة";
 saveBtn.innerText="حفظ التعديلات";
 dealId.value=id;
 dealId.disabled=true;

 investorName.value=data.investorName;
 investmentAmount.value=data.investmentAmount;
 profitNumber.value=data.profitNumber;

 if(data.feesRequired){
  hasFees.value="yes";
  feeAmount.classList.remove("hidden");
  feeAmount.value=data.feeAmount;
 }else{
  hasFees.value="no";
  feeAmount.classList.add("hidden");
  feeAmount.value="";
 }
}

function resetForm(){
 editMode=false;
 formTitle.innerText="إضافة صفقة";
 saveBtn.innerText="إضافة الصفقة";
 dealId.disabled=false;
 dealId.value="";
 investorName.value="";
 investmentAmount.value="";
 profitNumber.value="";
 hasFees.value="no";
 feeAmount.value="";
 feeAmount.classList.add("hidden");
}

function loadDeals(){
 db.collection("deals").onSnapshot(s=>{
  let h="";
  s.forEach(d=>{
   const x=d.data();
   h+=`<tr>
<td>${d.id}</td>
<td>${x.investorName}</td>
<td>${x.investmentAmount}</td>
<td>${x.feesRequired?x.feeAmount:"-"}</td>
<td>${x.feeStatus}</td>
<td><button class="edit" onclick='editDeal("${d.id}",${JSON.stringify(x)})'>تعديل</button></td>
</tr>`;
  });
  rows.innerHTML=h;
 });
}
</script>

</body>
</html>
