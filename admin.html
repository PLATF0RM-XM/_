<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{
 margin:0;
 font-family:Arial, sans-serif;
 background:linear-gradient(135deg,#081c3a,#0b2c5d);
 color:#fff;
}
.container{
 max-width:720px;
 margin:60px auto;
 background:rgba(255,255,255,0.12);
 backdrop-filter:blur(14px);
 padding:25px;
 border-radius:18px;
 box-shadow:0 20px 40px rgba(0,0,0,.35);
}
h2,h3{text-align:center;margin-bottom:15px}
input,select,button{
 width:100%;
 padding:14px;
 margin:8px 0;
 border:none;
 border-radius:12px;
 font-size:15px;
}
input,select{background:#fff;color:#000}
button{
 background:#00b05c;
 color:#fff;
 font-weight:bold;
 cursor:pointer;
}
button.danger{background:#c0392b}
table{
 width:100%;
 border-collapse:collapse;
 margin-top:20px;
}
th,td{
 padding:10px;
 border-bottom:1px solid rgba(255,255,255,.2);
 text-align:center;
}
th{background:rgba(0,0,0,.25)}
.time{width:120px}
#modal{
 display:none;
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.75);
 align-items:center;
 justify-content:center;
 z-index:999;
}
#modal img{
 max-width:90%;
 border-radius:14px;
 box-shadow:0 10px 30px rgba(0,0,0,.6);
}
</style>
</head>

<body>

<div class="container" id="login">
 <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
 <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
 <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
 <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="container" id="panel" style="display:none">
 <h3>Ø¥Ø¶Ø§ÙØ© ØµÙÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
 <input id="did" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙÙ‚Ø©">
 <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±">
 <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
 <input id="investment" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±">
 <input id="profit" placeholder="Ø§Ù„Ø£Ø±Ø¨Ø§Ø­">
 <input id="fee" placeholder="Ø§Ù„Ø±Ø³ÙˆÙ…">
 <button onclick="addDeal()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙ‚Ø©</button>

 <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙ‚Ø§Øª</h3>
 <button class="danger" onclick="deleteSelected()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</button>

 <table>
  <thead>
   <tr>
    <th><input type="checkbox" onclick="toggleAll(this)"></th>
    <th>Ø±Ù‚Ù… Ø§Ù„ØµÙÙ‚Ø©</th>
    <th>Ø§Ù„Ø§Ø³Ù…</th>
    <th>Ø¥Ø«Ø¨Ø§Øª</th>
    <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø³ÙˆÙ…</th>
    <th>ÙˆÙ‚Øª Ø§Ù„Ø³Ø¯Ø§Ø¯</th>
   </tr>
  </thead>
  <tbody id="rows"></tbody>
 </table>
</div>

<div id="modal" onclick="this.style.display='none'">
 <img id="proofImg">
</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDCVCtl1ca3NSoy6tAWCp-ykgGBa21ZNp8",
 authDomain:"investment-platform-b419d.firebaseapp.com",
 projectId:"investment-platform-b419d",
 storageBucket:"investment-platform-b419d.firebasestorage.app"
});

const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .then(()=>{
  login.style.display="none";
  panel.style.display="block";
  load();
 })
 .catch(e=>alert(e.message));
}

function addDeal(){
 db.collection("deals").doc(did.value).set({
  name:name.value,
  phone:phone.value,
  investment:investment.value,
  profit:profit.value,
  fee:fee.value,
  feeStatus:"ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…",
  feeTime:""
 });
 alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙ‚Ø©");
}

function load(){
 db.collection("deals").onSnapshot(s=>{
  let h="";
  s.forEach(d=>{
   const x=d.data();
   h+=`<tr>
<td><input type="checkbox" class="chk" value="${d.id}"></td>
<td>${d.id}</td>
<td>${x.name||""}</td>
<td><button onclick="viewProof('${d.id}')">Ø¹Ø±Ø¶</button></td>
<td>
<select onchange="updateFee('${d.id}',this.value,document.getElementById('t_${d.id}').value)">
 <option ${x.feeStatus=="ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…"?"selected":""}>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…</option>
 <option ${x.feeStatus=="ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…"?"selected":""}>ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…</option>
</select>
</td>
<td>
<input type="time" class="time" id="t_${d.id}" value="${x.feeTime||""}"
 onchange="updateFee('${d.id}',document.getElementById('s_${d.id}')?.value||'ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…',this.value)">
</td>
</tr>`;
  });
  rows.innerHTML=h;
 });
}

function updateFee(id,status,time){
 db.collection("deals").doc(id).update({
  feeStatus:status,
  feeTime: status==="ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…" ? time : ""
 });
}

function viewProof(id){
 storage.ref("proofs/"+id+".jpg").getDownloadURL()
 .then(url=>{
  proofImg.src=url;
  modal.style.display="flex";
 })
 .catch(()=>alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø«Ø¨Ø§Øª"));
}

function toggleAll(el){
 document.querySelectorAll(".chk").forEach(c=>c.checked=el.checked);
}

async function deleteSelected(){
 const ids=[...document.querySelectorAll(".chk:checked")].map(c=>c.value);
 if(ids.length===0){alert("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ØµÙÙ‚Ø§Øª");return;}
 if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŸ"))return;

 for(const id of ids){
  await db.collection("deals").doc(id).delete();
  storage.ref("proofs/"+id+".jpg").delete().catch(()=>{});
 }
 alert("ØªÙ… Ø§Ù„Ø­Ø°Ù");
}
</script>

</body>
</html>
