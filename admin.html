<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{font-family:Arial;background:#0b2c5d;color:#fff;padding:20px}
.card{background:rgba(255,255,255,.12);padding:20px;border-radius:15px;max-width:800px;margin:auto}
input,select,button{padding:8px;margin:4px;border-radius:6px;border:none}
button{background:#00b05c;color:#fff;font-weight:bold}
table{width:100%;margin-top:15px;border-collapse:collapse}
td,th{border:1px solid #fff;padding:6px;text-align:center}
a{color:#00ffcc}
</style>
</head>

<body>
<div id="loginBox" class="card">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
<input id="email" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="adminPanel" class="card" style="display:none">
<h3>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ ØµÙÙ‚Ø©</h3>
<input id="dealId" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙÙ‚Ø©">
<input id="investorName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±">
<input id="investmentAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±">
<input id="payoutNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„">

<select id="feesEnabled">
<option value="no">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³ÙˆÙ…</option>
<option value="yes">ØªÙˆØ¬Ø¯ Ø±Ø³ÙˆÙ…</option>
</select>

<input id="feesAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ø³ÙˆÙ…">
<button onclick="saveDeal()">Ø­ÙØ¸</button>
<button onclick="logout()" style="background:red">Ø®Ø±ÙˆØ¬</button>

<h3>Ø§Ù„ØµÙÙ‚Ø§Øª</h3>
<table>
<thead>
<tr><th>ID</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø«Ø¨Ø§Øª</th><th>ØªØ­ÙƒÙ…</th></tr>
</thead>
<tbody id="dealsTable"></tbody>
</table>
</div>

<script>
const firebaseConfig = {
 apiKey: "AIzaSyDCVCtl1ca3NSoy6tAWCp-ykgGBa21ZNp8",
 authDomain: "investment-platform-b419d.firebaseapp.com",
 databaseURL: "https://investment-platform-b419d-default-rtdb.firebaseio.com",
 projectId: "investment-platform-b419d",
 storageBucket: "investment-platform-b419d.firebasestorage.app",
 messagingSenderId: "831226258536",
 appId: "1:831226258536:web:df19777f6675a0e9cd07dd"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

auth.onAuthStateChanged(u=>{
 if(u){loginBox.style.display="none";adminPanel.style.display="block";loadDeals();}
});

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .catch(()=>alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©"));
}

function logout(){auth.signOut();location.reload();}

function saveDeal(){
 const id = dealId.value.trim();
 const name = investorName.value.trim();
 const hasFees = feesEnabled.value === "yes";

 // ğŸ”’ Ù…Ù†Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±
 if(!id || !name){
   alert("Ø±Ù‚Ù… Ø§Ù„ØµÙÙ‚Ø© ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ«Ù…Ø± Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†");
   return;
 }
 if(/^[0-9]+$/.test(name)){
   alert("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ«Ù…Ø± Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·");
   return;
 }

 db.ref("deals/" + id).set({
  dealId: id,
  investorName: name,
  investmentAmount: investmentAmount.value,
  payoutNumber: payoutNumber.value,
  feesEnabled: hasFees,
  feesAmount: hasFees ? feesAmount.value : "",
  status: hasFees ? "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…" : "ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯",
  paymentTime: hasFees ? "" : new Date().toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"}),
  createdAt: new Date().toLocaleString("ar-EG")
 }).then(()=>{
   alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙÙ‚Ø©");
   loadDeals();
 });
}

function loadDeals(){
 dealsTable.innerHTML="";
 db.ref("deals").once("value").then(s=>{
  s.forEach(d=>{
   const x=d.val();
   dealsTable.innerHTML+=`
   <tr>
    <td>${x.dealId}</td>
    <td>${x.investorName || "â€”"}</td>
    <td>${x.status}</td>
    <td>${x.paymentProof?`<a href="${x.paymentProof}" target="_blank">Ø¹Ø±Ø¶</a>`:"â€”"}</td>
    <td>${x.status==="Ù‚ÙŠØ¯ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯"?`<button onclick="approve('${x.dealId}')">ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯</button>`:""}</td>
   </tr>`;
  });
 });
}

function approve(id){
 const t=new Date().toLocaleTimeString('ar-EG',{hour:'2-digit',minute:'2-digit'});
 db.ref("deals/"+id).update({status:"ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯",paymentTime:t}).then(loadDeals);
}
</script>
</body>
</html>
