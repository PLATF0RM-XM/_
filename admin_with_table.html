<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة إدارة منصة XM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#08152c;color:#fff}
header{padding:20px;text-align:center;font-size:22px;background:linear-gradient(135deg,#0b2a52,#07162e)}
.box{max-width:1100px;margin:20px auto;background:rgba(255,255,255,.08);padding:20px;border-radius:16px}
input,select,button{padding:10px;border-radius:8px;border:none}
button{background:#00c176;font-weight:bold;color:#000}
.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.2);text-align:center}
img{max-width:120px;border-radius:8px;cursor:pointer}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center}
.modal img{max-width:90%;max-height:90%}
</style>
</head>

<body>

<header>لوحة إدارة منصة XM</header>

<div class="box" id="loginBox">
 <input id="email" placeholder="البريد الإلكتروني">
 <input id="password" type="password" placeholder="كلمة المرور">
 <button onclick="login()">تسجيل الدخول</button>
 <div id="error"></div>
</div>

<div class="box hidden" id="panel">
 <h3>جميع الصفقات</h3>
 <table>
  <thead>
   <tr>
    <th>رقم الصفقة</th>
    <th>المستثمر</th>
    <th>الهاتف</th>
    <th>الاستثمار</th>
    <th>الأرباح</th>
    <th>الحالة</th>
    <th>إثبات التحويل</th>
   </tr>
  </thead>
  <tbody id="rows"></tbody>
 </table>
 <button onclick="logout()" style="margin-top:15px;background:#ff5c5c">تسجيل الخروج</button>
</div>

<div class="modal" id="modal" onclick="this.style.display='none'">
 <img id="modalImg">
</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDCVCtl1ca3NSoy6tAWCp-ykgGBa21ZNp8",
 authDomain:"investment-platform-b419d.firebaseapp.com",
 projectId:"investment-platform-b419d"
});

const auth=firebase.auth();
const db=firebase.firestore();

auth.onAuthStateChanged(user=>{
 if(user){
  loginBox.classList.add("hidden");
  panel.classList.remove("hidden");
  loadTrades();
 }
});

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .catch(()=>error.innerText="بيانات الدخول غير صحيحة");
}

function loadTrades(){
 db.collection("trades").onSnapshot(snap=>{
  rows.innerHTML="";
  snap.forEach(d=>{
   const t=d.data();
   rows.innerHTML+=`
    <tr>
     <td>${d.id}</td>
     <td>${t.investorName||""}</td>
     <td>${t.investorPhone||""}</td>
     <td>${t.amount||""}</td>
     <td>${t.profit||""}</td>
     <td>${t.status||""}</td>
     <td>
      ${t.paymentImage?
       `<img src="${t.paymentImage}" onclick="viewImg('${t.paymentImage}')">`
       :"—"}
     </td>
    </tr>
   `;
  });
 });
}

function viewImg(src){
 modal.style.display="flex";
 modalImg.src=src;
}

function logout(){
 auth.signOut().then(()=>location.reload());
}
</script>

</body>
</html>
